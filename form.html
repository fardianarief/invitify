<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Isi Data Undangan ‚Äî Invitify</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #faf6f1; --warm: #f0e8dc; --gold: #c9a96e;
    --dark: #1a1410; --brown: #5c3d2e; --text: #3a2d25; --gray: #8a7a72;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Jost', sans-serif; background: var(--cream); color: var(--text); }

  header {
    background: var(--dark); color: white; padding: 1.2rem 3rem;
    display: flex; justify-content: space-between; align-items: center;
    position: sticky; top: 0; z-index: 50;
  }
  .h-logo { font-family: 'Cormorant Garamond', serif; font-size: 1.5rem; color: var(--gold); }
  .h-info { font-size: 0.8rem; color: rgba(255,255,255,0.6); }
  .h-key { color: var(--gold); font-weight: 500; }

  .container { max-width: 780px; margin: 0 auto; padding: 3rem 1.5rem; }

  .step-indicator {
    display: flex; justify-content: center; gap: 0.5rem;
    margin-bottom: 3rem;
  }
  .step {
    width: 32px; height: 32px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.75rem; font-weight: 500; cursor: pointer;
    border: 2px solid var(--warm); background: white; color: var(--gray);
    transition: all 0.3s;
  }
  .step.active { border-color: var(--gold); background: var(--gold); color: white; }
  .step.done { border-color: var(--gold); background: white; color: var(--gold); }
  .step-line { width: 40px; height: 2px; background: var(--warm); align-self: center; }
  .step-line.done { background: var(--gold); }

  /* SECTION CARD */
  .section-card {
    background: white; border-radius: 8px;
    border: 1px solid var(--warm);
    padding: 2rem; margin-bottom: 1.5rem;
    display: none;
  }
  .section-card.active { display: block; }
  .card-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.4rem; color: var(--dark); margin-bottom: 0.3rem;
  }
  .card-sub { font-size: 0.82rem; color: var(--gray); margin-bottom: 1.5rem; }

  /* FORM */
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }
  .form-group { margin-bottom: 1rem; }
  .form-label {
    display: block; font-size: 0.78rem; font-weight: 500;
    color: var(--brown); margin-bottom: 0.4rem;
    letter-spacing: 0.05em; text-transform: uppercase;
  }
  .form-label .req { color: var(--gold); }
  .form-input, .form-select, .form-textarea {
    width: 100%; padding: 0.75rem 1rem;
    border: 1px solid var(--warm); border-radius: 4px;
    font-family: 'Jost', sans-serif; font-size: 0.9rem;
    color: var(--text); background: var(--cream);
    transition: border-color 0.3s; outline: none;
  }
  .form-input:focus, .form-select:focus, .form-textarea:focus {
    border-color: var(--gold); background: white;
  }
  .form-textarea { resize: vertical; min-height: 80px; }

  /* BANK ACCOUNTS */
  .bank-list { margin-bottom: 1rem; }
  .bank-item {
    background: var(--cream); border: 1px solid var(--warm);
    border-radius: 6px; padding: 1rem; margin-bottom: 0.7rem;
    position: relative;
  }
  .bank-row { display: grid; grid-template-columns: 1fr 1.5fr 1fr; gap: 0.7rem; }
  .bank-remove {
    position: absolute; top: 0.7rem; right: 0.7rem;
    background: none; border: none; color: #e05555;
    cursor: pointer; font-size: 1rem; padding: 0.2rem;
  }
  .add-bank-btn {
    background: none; border: 1px dashed var(--gold); color: var(--gold);
    padding: 0.7rem 1.5rem; border-radius: 4px; cursor: pointer;
    font-family: 'Jost', sans-serif; font-size: 0.82rem;
    letter-spacing: 0.05em; transition: all 0.3s; width: 100%;
  }
  .add-bank-btn:hover { background: var(--warm); }

  /* PHOTO UPLOAD */
  .photo-upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  .photo-box {
    border: 2px dashed var(--warm); border-radius: 8px;
    padding: 1.5rem; text-align: center; cursor: pointer;
    transition: all 0.3s; position: relative; overflow: hidden;
  }
  .photo-box:hover { border-color: var(--gold); background: rgba(201,169,110,0.05); }
  .photo-box.has-image { border-style: solid; border-color: var(--gold); }
  .photo-box input[type="file"] {
    position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
  }
  .photo-icon { font-size: 2rem; margin-bottom: 0.5rem; }
  .photo-label { font-size: 0.8rem; font-weight: 500; color: var(--brown); }
  .photo-sub { font-size: 0.72rem; color: var(--gray); margin-top: 0.2rem; }
  .photo-preview {
    width: 100%; height: 120px; object-fit: cover;
    border-radius: 4px; display: none;
  }
  .photo-box.has-image .photo-preview { display: block; }
  .photo-box.has-image .photo-placeholder { display: none; }
  .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.8rem; margin-top: 1rem; }

  /* OPTIONAL FEATURES */
  .feature-toggle {
    display: flex; align-items: center; justify-content: space-between;
    padding: 1rem 1.2rem; background: var(--cream);
    border: 1px solid var(--warm); border-radius: 6px; margin-bottom: 0.8rem;
    cursor: pointer; transition: all 0.3s;
  }
  .feature-toggle.enabled { border-color: var(--gold); background: rgba(201,169,110,0.05); }
  .ft-info { display: flex; align-items: center; gap: 0.8rem; }
  .ft-icon { font-size: 1.3rem; }
  .ft-name { font-size: 0.9rem; font-weight: 500; }
  .ft-desc { font-size: 0.78rem; color: var(--gray); }
  .toggle-switch {
    width: 44px; height: 24px; background: var(--warm);
    border-radius: 12px; position: relative; transition: background 0.3s;
  }
  .feature-toggle.enabled .toggle-switch { background: var(--gold); }
  .toggle-dot {
    width: 18px; height: 18px; background: white;
    border-radius: 50%; position: absolute; top: 3px; left: 3px;
    transition: left 0.3s; box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }
  .feature-toggle.enabled .toggle-dot { left: 23px; }
  .feature-content { display: none; padding: 1rem 1.2rem; background: white; border: 1px solid var(--gold); border-top: none; border-radius: 0 0 6px 6px; margin-top: -8px; margin-bottom: 0.8rem; }
  .feature-toggle.enabled + .feature-content { display: block; }

  /* NAV BUTTONS */
  .form-nav {
    display: flex; justify-content: space-between; align-items: center;
    margin-top: 2rem; padding-top: 1.5rem;
    border-top: 1px solid var(--warm);
  }
  .btn-prev {
    background: none; border: 1px solid var(--warm); color: var(--gray);
    padding: 0.8rem 1.8rem; border-radius: 4px; cursor: pointer;
    font-family: 'Jost', sans-serif; font-size: 0.82rem;
    letter-spacing: 0.05em; transition: all 0.3s;
  }
  .btn-prev:hover { border-color: var(--gold); color: var(--brown); }
  .btn-next {
    background: var(--gold); color: white;
    padding: 0.8rem 2rem; border: none; border-radius: 4px; cursor: pointer;
    font-family: 'Jost', sans-serif; font-size: 0.82rem;
    letter-spacing: 0.08em; text-transform: uppercase; transition: background 0.3s;
  }
  .btn-next:hover { background: var(--brown); }
  .btn-save {
    background: var(--dark); color: var(--gold);
    padding: 0.8rem 2.5rem; border: 1px solid var(--gold); border-radius: 4px; cursor: pointer;
    font-family: 'Jost', sans-serif; font-size: 0.85rem;
    letter-spacing: 0.1em; text-transform: uppercase; transition: all 0.3s;
  }
  .btn-save:hover { background: var(--gold); color: white; }

  .progress-bar {
    height: 3px; background: var(--warm); border-radius: 2px;
    margin-bottom: 1.5rem; overflow: hidden;
  }
  .progress-fill { height: 100%; background: var(--gold); transition: width 0.4s ease; }

  @media (max-width: 600px) {
    .form-row { grid-template-columns: 1fr; }
    .bank-row { grid-template-columns: 1fr; }
    .photo-upload-grid { grid-template-columns: 1fr; }
    .gallery-grid { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>

<header>
  <div class="h-logo">Invitify</div>
  <div class="h-info">Passkey: <span class="h-key" id="headerKey">‚Äî</span> | <span id="headerCustomer">Loading...</span></div>
</header>

<div class="container">
  <div style="text-align:center; margin-bottom:2rem;">
    <div style="font-family:'Cormorant Garamond',serif; font-size:2rem; color:var(--dark)">Formulir Data Undangan</div>
    <p style="color:var(--gray); font-size:0.85rem; margin-top:0.3rem">Isi semua informasi dengan benar untuk membuat undangan digital Anda</p>
  </div>

  <div class="progress-bar">
    <div class="progress-fill" id="progressFill" style="width:25%"></div>
  </div>

  <div class="step-indicator">
    <div class="step active" onclick="goStep(1)" id="step1">1</div>
    <div class="step-line" id="line1"></div>
    <div class="step" onclick="goStep(2)" id="step2">2</div>
    <div class="step-line" id="line2"></div>
    <div class="step" onclick="goStep(3)" id="step3">3</div>
    <div class="step-line" id="line3"></div>
    <div class="step" onclick="goStep(4)" id="step4">4</div>
  </div>

  <!-- STEP 1: DATA MEMPELAI -->
  <div class="section-card active" id="card1">
    <div class="card-title">üë´ Data Mempelai</div>
    <div class="card-sub">Informasi nama dan detail mempelai pria & wanita</div>

    <div style="font-size:0.82rem; font-weight:500; color:var(--brown); margin-bottom:1rem; text-transform:uppercase; letter-spacing:0.05em">Mempelai Pria</div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Nama Lengkap <span class="req">*</span></label>
        <input type="text" class="form-input" id="groomFull" placeholder="Budi Santoso">
      </div>
      <div class="form-group">
        <label class="form-label">Nama Panggilan</label>
        <input type="text" class="form-input" id="groomNick" placeholder="Budi">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Putra ke-</label>
        <input type="text" class="form-input" id="groomOrder" placeholder="1 (Pertama)">
      </div>
      <div class="form-group">
        <label class="form-label">Nama Orang Tua</label>
        <input type="text" class="form-input" id="groomParents" placeholder="Bpk. Ahmad & Ibu Siti">
      </div>
    </div>

    <div style="height:1px; background:var(--warm); margin:1.5rem 0;"></div>

    <div style="font-size:0.82rem; font-weight:500; color:var(--brown); margin-bottom:1rem; text-transform:uppercase; letter-spacing:0.05em">Mempelai Wanita</div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Nama Lengkap <span class="req">*</span></label>
        <input type="text" class="form-input" id="brideFull" placeholder="Rahma Aulia">
      </div>
      <div class="form-group">
        <label class="form-label">Nama Panggilan</label>
        <input type="text" class="form-input" id="brideNick" placeholder="Rahma">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Putri ke-</label>
        <input type="text" class="form-input" id="brideOrder" placeholder="2 (Kedua)">
      </div>
      <div class="form-group">
        <label class="form-label">Nama Orang Tua</label>
        <input type="text" class="form-input" id="brideParents" placeholder="Bpk. Hasan & Ibu Dewi">
      </div>
    </div>

    <div class="form-nav">
      <div></div>
      <button class="btn-next" onclick="nextStep()">Selanjutnya ‚Üí</button>
    </div>
  </div>

  <!-- STEP 2: TANGGAL & ACARA -->
  <div class="section-card" id="card2">
    <div class="card-title">üìÖ Tanggal & Acara</div>
    <div class="card-sub">Detail tanggal, waktu, dan lokasi acara pernikahan</div>

    <div style="font-size:0.82rem; font-weight:500; color:var(--brown); margin-bottom:1rem; text-transform:uppercase; letter-spacing:0.05em">Akad Nikah</div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Tanggal Akad <span class="req">*</span></label>
        <input type="date" class="form-input" id="akadDate">
      </div>
      <div class="form-group">
        <label class="form-label">Hari</label>
        <input type="text" class="form-input" id="akadDay" placeholder="Sabtu" readonly>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Jam Mulai</label>
        <input type="time" class="form-input" id="akadStart">
      </div>
      <div class="form-group">
        <label class="form-label">Jam Selesai</label>
        <input type="time" class="form-input" id="akadEnd">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Nama Tempat</label>
      <input type="text" class="form-input" id="akadVenue" placeholder="Masjid Al-Hidayah, Jakarta Selatan">
    </div>

    <div style="height:1px; background:var(--warm); margin:1.5rem 0;"></div>

    <div style="font-size:0.82rem; font-weight:500; color:var(--brown); margin-bottom:1rem; text-transform:uppercase; letter-spacing:0.05em">Resepsi</div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Tanggal Resepsi <span class="req">*</span></label>
        <input type="date" class="form-input" id="resepsiDate">
      </div>
      <div class="form-group">
        <label class="form-label">Hari</label>
        <input type="text" class="form-input" id="resepsiDay" placeholder="Sabtu" readonly>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Jam Mulai</label>
        <input type="time" class="form-input" id="resepsiStart">
      </div>
      <div class="form-group">
        <label class="form-label">Jam Selesai</label>
        <input type="time" class="form-input" id="resepsiEnd">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Nama Tempat</label>
      <input type="text" class="form-input" id="resepsiVenue" placeholder="Gedung Serbaguna XYZ, Jakarta">
    </div>
    <div class="form-group">
      <label class="form-label">Alamat Lengkap</label>
      <textarea class="form-textarea" id="resepsiAddress" placeholder="Jl. Contoh No. 123, RT 01/RW 02, Kel. Maju, Kec. Jaya, Jakarta Selatan 12345"></textarea>
    </div>

    <div class="form-nav">
      <button class="btn-prev" onclick="prevStep()">‚Üê Kembali</button>
      <button class="btn-next" onclick="nextStep()">Selanjutnya ‚Üí</button>
    </div>
  </div>

  <!-- STEP 3: FOTO & REKENING -->
  <div class="section-card" id="card3">
    <div class="card-title">üì∏ Foto & Rekening</div>
    <div class="card-sub">Upload foto dan informasi rekening bank untuk amplop digital</div>

    <div style="font-size:0.82rem; font-weight:500; color:var(--brown); margin-bottom:1rem; text-transform:uppercase; letter-spacing:0.05em">Foto Utama</div>
    <div class="photo-upload-grid">
      <div class="photo-box" id="coverBox">
        <input type="file" accept="image/*" onchange="previewPhoto(this, 'coverBox', 'coverPreview')">
        <img class="photo-preview" id="coverPreview" src="">
        <div class="photo-placeholder">
          <div class="photo-icon">üñºÔ∏è</div>
          <div class="photo-label">Foto Sampul</div>
          <div class="photo-sub">Foto utama di halaman depan</div>
        </div>
      </div>
      <div class="photo-box" id="middleBox">
        <input type="file" accept="image/*" onchange="previewPhoto(this, 'middleBox', 'middlePreview')">
        <img class="photo-preview" id="middlePreview" src="">
        <div class="photo-placeholder">
          <div class="photo-icon">üíë</div>
          <div class="photo-label">Foto Tengah</div>
          <div class="photo-sub">Foto di bagian tengah undangan</div>
        </div>
      </div>
    </div>

    <div style="font-size:0.82rem; font-weight:500; color:var(--brown); margin:1.5rem 0 1rem; text-transform:uppercase; letter-spacing:0.05em">Galeri Foto (maks. 5 foto)</div>
    <div class="gallery-grid" id="galleryGrid">
      <div class="photo-box" id="gal1">
        <input type="file" accept="image/*" onchange="previewPhoto(this, 'gal1', 'galPrev1')">
        <img class="photo-preview" id="galPrev1" src="">
        <div class="photo-placeholder">
          <div class="photo-icon">üì∑</div>
          <div class="photo-label">Galeri 1</div>
        </div>
      </div>
      <div class="photo-box" id="gal2">
        <input type="file" accept="image/*" onchange="previewPhoto(this, 'gal2', 'galPrev2')">
        <img class="photo-preview" id="galPrev2" src="">
        <div class="photo-placeholder">
          <div class="photo-icon">üì∑</div>
          <div class="photo-label">Galeri 2</div>
        </div>
      </div>
      <div class="photo-box" id="gal3">
        <input type="file" accept="image/*" onchange="previewPhoto(this, 'gal3', 'galPrev3')">
        <img class="photo-preview" id="galPrev3" src="">
        <div class="photo-placeholder">
          <div class="photo-icon">üì∑</div>
          <div class="photo-label">Galeri 3</div>
        </div>
      </div>
      <div class="photo-box" id="gal4">
        <input type="file" accept="image/*" onchange="previewPhoto(this, 'gal4', 'galPrev4')">
        <img class="photo-preview" id="galPrev4" src="">
        <div class="photo-placeholder">
          <div class="photo-icon">üì∑</div>
          <div class="photo-label">Galeri 4</div>
        </div>
      </div>
      <div class="photo-box" id="gal5">
        <input type="file" accept="image/*" onchange="previewPhoto(this, 'gal5', 'galPrev5')">
        <img class="photo-preview" id="galPrev5" src="">
        <div class="photo-placeholder">
          <div class="photo-icon">üì∑</div>
          <div class="photo-label">Galeri 5</div>
        </div>
      </div>
    </div>

    <div style="height:1px; background:var(--warm); margin:2rem 0 1.5rem;"></div>

    <div style="font-size:0.82rem; font-weight:500; color:var(--brown); margin-bottom:1rem; text-transform:uppercase; letter-spacing:0.05em">Informasi Rekening (Opsional)</div>
    <div class="bank-list" id="bankList">
      <div class="bank-item" id="bankItem0">
        <button class="bank-remove" onclick="removeBank(0)" title="Hapus">‚úï</button>
        <div class="bank-row">
          <div>
            <label class="form-label">Bank</label>
            <select class="form-select" id="bank0">
              <option value="">Pilih Bank</option>
              <option>BCA</option><option>BNI</option><option>BRI</option>
              <option>Mandiri</option><option>BSI</option><option>CIMB Niaga</option>
              <option>Permata</option><option>Danamon</option><option>GoPay</option>
              <option>OVO</option><option>Dana</option><option>ShopeePay</option>
            </select>
          </div>
          <div>
            <label class="form-label">Nama Pemilik</label>
            <input type="text" class="form-input" id="bankName0" placeholder="Nama pemilik rekening">
          </div>
          <div>
            <label class="form-label">Nomor Rekening</label>
            <input type="text" class="form-input" id="bankNum0" placeholder="1234567890">
          </div>
        </div>
      </div>
    </div>
    <button class="add-bank-btn" onclick="addBank()">+ Tambah Rekening Lain</button>

    <div class="form-nav">
      <button class="btn-prev" onclick="prevStep()">‚Üê Kembali</button>
      <button class="btn-next" onclick="nextStep()">Selanjutnya ‚Üí</button>
    </div>
  </div>

  <!-- STEP 4: FITUR TAMBAHAN -->
  <div class="section-card" id="card4">
    <div class="card-title">‚ú® Fitur Tambahan</div>
    <div class="card-sub">Aktifkan fitur-fitur pelengkap untuk undangan Anda</div>

    <!-- MAPS -->
    <div class="feature-toggle" onclick="toggleFeature(this, 'mapsContent')">
      <div class="ft-info">
        <div class="ft-icon">üìç</div>
        <div>
          <div class="ft-name">Google Maps</div>
          <div class="ft-desc">Tampilkan lokasi acara via Google Maps</div>
        </div>
      </div>
      <div class="toggle-switch"><div class="toggle-dot"></div></div>
    </div>
    <div class="feature-content" id="mapsContent">
      <div class="form-group">
        <label class="form-label">Link Google Maps Akad</label>
        <input type="url" class="form-input" id="mapsAkad" placeholder="https://maps.google.com/?q=...">
      </div>
      <div class="form-group">
        <label class="form-label">Link Google Maps Resepsi</label>
        <input type="url" class="form-input" id="mapsResepsi" placeholder="https://maps.google.com/?q=...">
      </div>
    </div>

    <!-- QUOTES -->
    <div class="feature-toggle" onclick="toggleFeature(this, 'quoteContent')">
      <div class="ft-info">
        <div class="ft-icon">üí¨</div>
        <div>
          <div class="ft-name">Kartu Ucapan Tamu</div>
          <div class="ft-desc">Formulir ucapan & doa dari tamu undangan</div>
        </div>
      </div>
      <div class="toggle-switch"><div class="toggle-dot"></div></div>
    </div>
    <div class="feature-content" id="quoteContent">
      <p style="font-size:0.82rem; color:var(--gray); margin-bottom:0.8rem">Fitur ini akan menambahkan formulir ucapan di undangan. Tamu bisa mengisi nama dan pesan ucapan mereka.</p>
      <div class="form-group">
        <label class="form-label">Judul Bagian Ucapan</label>
        <input type="text" class="form-input" id="wishTitle" placeholder="Kirim Doa &amp; Ucapan" value="Kirim Doa &amp; Ucapan">
      </div>
    </div>

    <!-- COUNTDOWN -->
    <div class="feature-toggle" onclick="toggleFeature(this, 'countdownContent')">
      <div class="ft-info">
        <div class="ft-icon">‚è≥</div>
        <div>
          <div class="ft-name">Countdown Timer</div>
          <div class="ft-desc">Hitung mundur menuju hari pernikahan</div>
        </div>
      </div>
      <div class="toggle-switch"><div class="toggle-dot"></div></div>
    </div>
    <div class="feature-content" id="countdownContent">
      <p style="font-size:0.82rem; color:var(--gray)">Countdown timer akan otomatis menggunakan tanggal akad/resepsi yang sudah Anda isi.</p>
    </div>

    <!-- MUSIC -->
    <div class="feature-toggle" onclick="toggleFeature(this, 'musicContent')">
      <div class="ft-info">
        <div class="ft-icon">üéµ</div>
        <div>
          <div class="ft-name">Musik Latar</div>
          <div class="ft-desc">Tambahkan musik saat undangan dibuka</div>
        </div>
      </div>
      <div class="toggle-switch"><div class="toggle-dot"></div></div>
    </div>
    <div class="feature-content" id="musicContent">
      <div class="form-group">
        <label class="form-label">Judul Lagu (info saja)</label>
        <input type="text" class="form-input" id="musicTitle" placeholder="Cant Help Falling In Love - Elvis Presley">
      </div>
      <div class="form-group">
        <label class="form-label">Upload File Musik (MP3/OGG)</label>
        <input type="file" accept="audio/*" class="form-input" id="musicFile" style="padding:0.5rem; cursor:pointer">
      </div>
    </div>

    <!-- QUOTE TEXT -->
    <div class="feature-toggle" onclick="toggleFeature(this, 'verseContent')">
      <div class="ft-info">
        <div class="ft-icon">üìñ</div>
        <div>
          <div class="ft-name">Ayat / Kutipan</div>
          <div class="ft-desc">Tambahkan ayat Al-Quran atau kutipan inspiratif</div>
        </div>
      </div>
      <div class="toggle-switch"><div class="toggle-dot"></div></div>
    </div>
    <div class="feature-content" id="verseContent">
      <div class="form-group">
        <label class="form-label">Teks Ayat / Kutipan</label>
        <textarea class="form-textarea" id="verseText" placeholder="Dan di antara tanda-tanda (kebesaran)-Nya ialah Dia menciptakan pasangan-pasangan untukmu dari jenismu sendiri..."></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Sumber (QS. / Penulis)</label>
        <input type="text" class="form-input" id="verseSource" placeholder="QS. Ar-Rum: 21">
      </div>
    </div>

    <div class="form-nav">
      <button class="btn-prev" onclick="prevStep()">‚Üê Kembali</button>
      <button class="btn-save" onclick="saveAndGenerate()">üíæ Simpan & Buat Undangan</button>
    </div>
  </div>

  <!-- SUCCESS MESSAGE -->
  <div id="successMsg" style="display:none; text-align:center; padding: 3rem; background:white; border-radius:8px; border:1px solid var(--warm);">
    <div style="font-size:3rem; margin-bottom:1rem">‚úÖ</div>
    <h2 style="font-family:'Cormorant Garamond',serif; font-size:2rem; color:var(--dark); margin-bottom:0.5rem">Data Tersimpan!</h2>
    <p style="color:var(--gray); margin-bottom:2rem">Undangan digital Anda sedang dalam proses pembuatan. Tim kami akan segera menghubungi Anda.</p>
    <div id="downloadBtn" style="margin-bottom:1rem;"></div>
    <a href="index.html" style="color:var(--gold); font-size:0.85rem; text-decoration:none">‚Üê Kembali ke Beranda</a>
  </div>

</div>

<script>
let currentStep = 1;
let totalSteps = 4;
let bankCount = 1;
const passkey = new URLSearchParams(window.location.search).get('key') || sessionStorage.getItem('invitify_key');
const customerData = JSON.parse(sessionStorage.getItem('invitify_customer') || '{}');

// AUTH CHECK
window.addEventListener('DOMContentLoaded', () => {
  if (!passkey) {
    alert('Akses tidak diizinkan. Silakan masukkan passkey terlebih dahulu.');
    window.location.href = 'index.html#access';
    return;
  }
  document.getElementById('headerKey').textContent = passkey;
  document.getElementById('headerCustomer').textContent = customerData.customer || '‚Äî';
});

// STEP NAVIGATION
function goStep(n) {
  if (n < 1 || n > totalSteps) return;
  document.getElementById('card' + currentStep).classList.remove('active');
  currentStep = n;
  document.getElementById('card' + currentStep).classList.add('active');
  updateSteps();
}
function nextStep() { if (currentStep < totalSteps) goStep(currentStep + 1); }
function prevStep() { if (currentStep > 1) goStep(currentStep - 1); }

function updateSteps() {
  for (let i = 1; i <= totalSteps; i++) {
    const el = document.getElementById('step' + i);
    el.classList.remove('active', 'done');
    if (i < currentStep) el.classList.add('done');
    else if (i === currentStep) el.classList.add('active');
    if (i < totalSteps) {
      const line = document.getElementById('line' + i);
      if (i < currentStep) line.classList.add('done');
      else line.classList.remove('done');
    }
  }
  document.getElementById('progressFill').style.width = (currentStep / totalSteps * 100) + '%';
}

// DATE ‚Üí DAY
const days = ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
document.getElementById('akadDate').addEventListener('change', function() {
  const d = new Date(this.value);
  document.getElementById('akadDay').value = isNaN(d) ? '' : days[d.getDay()];
});
document.getElementById('resepsiDate').addEventListener('change', function() {
  const d = new Date(this.value);
  document.getElementById('resepsiDay').value = isNaN(d) ? '' : days[d.getDay()];
});

// PHOTO PREVIEW
function previewPhoto(input, boxId, previewId) {
  if (!input.files[0]) return;
  const reader = new FileReader();
  reader.onload = e => {
    document.getElementById(previewId).src = e.target.result;
    document.getElementById(boxId).classList.add('has-image');
  };
  reader.readAsDataURL(input.files[0]);
}

// BANK
function addBank() {
  const idx = bankCount++;
  const div = document.createElement('div');
  div.className = 'bank-item';
  div.id = 'bankItem' + idx;
  div.innerHTML = `
    <button class="bank-remove" onclick="removeBank(${idx})" title="Hapus">‚úï</button>
    <div class="bank-row">
      <div>
        <label class="form-label">Bank</label>
        <select class="form-select" id="bank${idx}">
          <option value="">Pilih Bank</option>
          <option>BCA</option><option>BNI</option><option>BRI</option>
          <option>Mandiri</option><option>BSI</option><option>CIMB Niaga</option>
          <option>Permata</option><option>Danamon</option><option>GoPay</option>
          <option>OVO</option><option>Dana</option><option>ShopeePay</option>
        </select>
      </div>
      <div>
        <label class="form-label">Nama Pemilik</label>
        <input type="text" class="form-input" id="bankName${idx}" placeholder="Nama pemilik rekening">
      </div>
      <div>
        <label class="form-label">Nomor Rekening</label>
        <input type="text" class="form-input" id="bankNum${idx}" placeholder="1234567890">
      </div>
    </div>`;
  document.getElementById('bankList').appendChild(div);
}
function removeBank(idx) {
  const el = document.getElementById('bankItem' + idx);
  if (el) el.remove();
}

// FEATURE TOGGLE
function toggleFeature(el, contentId) {
  el.classList.toggle('enabled');
}

// COLLECT ALL DATA
function collectData() {
  const banks = [];
  document.querySelectorAll('.bank-item').forEach((item, i) => {
    const idx = item.id.replace('bankItem', '');
    const bank = document.getElementById('bank' + idx)?.value;
    const name = document.getElementById('bankName' + idx)?.value;
    const num = document.getElementById('bankNum' + idx)?.value;
    if (bank || name || num) banks.push({ bank, name, num });
  });

  const features = {
    maps: document.querySelector('.feature-toggle:nth-of-type(1)')?.classList.contains('enabled'),
    wishes: document.querySelector('.feature-toggle:nth-of-type(2)')?.classList.contains('enabled'),
    countdown: document.querySelector('.feature-toggle:nth-of-type(3)')?.classList.contains('enabled'),
    music: document.querySelector('.feature-toggle:nth-of-type(4)')?.classList.contains('enabled'),
    verse: document.querySelector('.feature-toggle:nth-of-type(5)')?.classList.contains('enabled'),
  };

  return {
    passkey,
    theme: customerData.theme || 'elegant-rose',
    package: customerData.package || 'Standard',
    groom: {
      full: document.getElementById('groomFull').value,
      nick: document.getElementById('groomNick').value,
      order: document.getElementById('groomOrder').value,
      parents: document.getElementById('groomParents').value,
    },
    bride: {
      full: document.getElementById('brideFull').value,
      nick: document.getElementById('brideNick').value,
      order: document.getElementById('brideOrder').value,
      parents: document.getElementById('brideParents').value,
    },
    akad: {
      date: document.getElementById('akadDate').value,
      day: document.getElementById('akadDay').value,
      start: document.getElementById('akadStart').value,
      end: document.getElementById('akadEnd').value,
      venue: document.getElementById('akadVenue').value,
    },
    resepsi: {
      date: document.getElementById('resepsiDate').value,
      day: document.getElementById('resepsiDay').value,
      start: document.getElementById('resepsiStart').value,
      end: document.getElementById('resepsiEnd').value,
      venue: document.getElementById('resepsiVenue').value,
      address: document.getElementById('resepsiAddress').value,
    },
    banks,
    features,
    mapsAkad: document.getElementById('mapsAkad')?.value,
    mapsResepsi: document.getElementById('mapsResepsi')?.value,
    wishTitle: document.getElementById('wishTitle')?.value,
    verseText: document.getElementById('verseText')?.value,
    verseSource: document.getElementById('verseSource')?.value,
    musicTitle: document.getElementById('musicTitle')?.value,
    photos: {
      cover: document.getElementById('coverPreview').src || '',
      middle: document.getElementById('middlePreview').src || '',
      gallery: [
        document.getElementById('galPrev1').src || '',
        document.getElementById('galPrev2').src || '',
        document.getElementById('galPrev3').src || '',
        document.getElementById('galPrev4').src || '',
        document.getElementById('galPrev5').src || '',
      ].filter(s => s && s !== window.location.href),
    }
  };
}

// GENERATE & SAVE
function saveAndGenerate() {
  const data = collectData();

  if (!data.groom.full || !data.bride.full) {
    alert('Mohon isi nama mempelai pria dan wanita terlebih dahulu.');
    goStep(1); return;
  }
  if (!data.akad.date && !data.resepsi.date) {
    alert('Mohon isi tanggal acara terlebih dahulu.');
    goStep(2); return;
  }

  // Store data
  localStorage.setItem('invitify_data_' + passkey, JSON.stringify(data));

  // Generate invitation HTML
  const html = generateInvitationHTML(data);

  // Create download
  const blob = new Blob([html], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const fileName = `undangan-${data.groom.nick || 'pria'}-${data.bride.nick || 'wanita'}.html`;

  // Show success
  document.getElementById('card4').style.display = 'none';
  document.getElementById('successMsg').style.display = 'block';
  document.getElementById('downloadBtn').innerHTML = `
    <a href="${url}" download="${fileName}" style="
      display:inline-block; padding:1rem 2.5rem;
      background:var(--gold); color:white; text-decoration:none;
      border-radius:4px; font-size:0.85rem; letter-spacing:0.1em; text-transform:uppercase;
      margin-bottom:0.5rem;
    ">‚¨á Download Undangan Digital</a>
    <div style="font-size:0.78rem; color:var(--gray); margin-top:0.5rem">File: ${fileName}</div>`;
}

function fmt(t) {
  if (!t) return '';
  const [h, m] = t.split(':');
  const hour = parseInt(h);
  return `${hour < 12 ? hour : hour === 12 ? 12 : hour - 12}.${m} ${hour < 12 ? 'AM' : 'PM'}`;
}

function generateInvitationHTML(d) {
  const themeColors = {
    'elegant-rose': { bg: '#fdf0f0', cover: 'linear-gradient(135deg, #f7d0d0, #e8a8a8)', text: '#7a2020', accent: '#c05050', light: '#fdf8f8' },
    'garden-green': { bg: '#f0f8f0', cover: 'linear-gradient(135deg, #c8e8b8, #98d888)', text: '#1a4012', accent: '#4a8040', light: '#f0f8f0' },
    'royal-gold': { bg: '#100e0a', cover: 'linear-gradient(135deg, #1a1410, #2d2218)', text: '#e8d5b0', accent: '#c9a96e', light: '#1a1410' },
    'minimalist-white': { bg: '#fafafa', cover: 'linear-gradient(135deg, #ffffff, #f0f0f0)', text: '#1a1a1a', accent: '#888888', light: '#ffffff' },
    'rustic-wood': { bg: '#3d2410', cover: 'linear-gradient(135deg, #4a2e18, #6b3d20)', text: '#f0d8b0', accent: '#c9a96e', light: '#4a2e18' },
  };
  const t = themeColors[d.theme] || themeColors['elegant-rose'];
  const isDark = ['royal-gold', 'rustic-wood'].includes(d.theme);

  const akadFormatted = d.akad.date ? new Date(d.akad.date).toLocaleDateString('id-ID', { weekday:'long', year:'numeric', month:'long', day:'numeric' }) : '';
  const resepsiFormatted = d.resepsi.date ? new Date(d.resepsi.date).toLocaleDateString('id-ID', { weekday:'long', year:'numeric', month:'long', day:'numeric' }) : '';

  const banksHTML = d.banks.map(b => `
    <div style="background:${isDark ? 'rgba(255,255,255,0.05)' : 'white'}; border:1px solid ${isDark ? 'rgba(201,169,110,0.2)' : '#f0e8dc'}; border-radius:8px; padding:1rem 1.5rem; margin-bottom:0.8rem; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.5rem;">
      <div><div style="font-size:0.72rem; color:${t.accent}; text-transform:uppercase; letter-spacing:0.1em; margin-bottom:0.3rem">${b.bank}</div>
      <div style="font-size:1rem; font-weight:500; color:${t.text}; letter-spacing:0.05em">${b.num}</div>
      <div style="font-size:0.78rem; color:${isDark ? 'rgba(255,255,255,0.5)' : '#8a7a72'}">${b.name}</div></div>
      <button onclick="navigator.clipboard.writeText('${b.num}').then(()=>alert('Nomor rekening disalin!'))" style="background:${t.accent}; color:white; border:none; padding:0.4rem 0.9rem; border-radius:4px; font-size:0.72rem; cursor:pointer">Salin</button>
    </div>`).join('');

  const galleryImgs = d.photos.gallery.filter(Boolean).map(src =>
    `<div style="aspect-ratio:1; border-radius:6px; overflow:hidden; background:#ddd;">
      <img src="${src}" style="width:100%; height:100%; object-fit:cover;" alt="Foto Galeri">
    </div>`).join('');

  const wishFormHTML = d.features.wishes ? `
    <section style="padding:3rem 1.5rem; text-align:center; background:${isDark ? 'rgba(255,255,255,0.03)' : '#faf6f1'};">
      <h2 style="font-family:'Cormorant Garamond',serif; font-size:1.8rem; color:${t.text}; margin-bottom:0.5rem">${d.wishTitle || 'Kirim Ucapan & Doa'}</h2>
      <p style="color:${isDark ? 'rgba(255,255,255,0.5)' : '#8a7a72'}; font-size:0.85rem; margin-bottom:1.5rem">Tuliskan doa dan ucapan terbaik Anda untuk kami</p>
      <div style="max-width:480px; margin:0 auto; background:${isDark ? 'rgba(255,255,255,0.05)' : 'white'}; border:1px solid ${isDark ? 'rgba(201,169,110,0.2)' : '#f0e8dc'}; border-radius:8px; padding:1.5rem;">
        <input type="text" placeholder="Nama Anda" id="wishName" style="width:100%; padding:0.7rem 1rem; margin-bottom:0.8rem; border:1px solid ${isDark ? 'rgba(201,169,110,0.2)' : '#f0e8dc'}; border-radius:4px; font-family:'Jost',sans-serif; font-size:0.9rem; background:${isDark ? 'rgba(255,255,255,0.05)' : '#faf6f1'}; color:${t.text}; outline:none">
        <textarea placeholder="Tulis ucapan & doa Anda..." id="wishMsg" style="width:100%; padding:0.7rem 1rem; border:1px solid ${isDark ? 'rgba(201,169,110,0.2)' : '#f0e8dc'}; border-radius:4px; font-family:'Jost',sans-serif; font-size:0.9rem; background:${isDark ? 'rgba(255,255,255,0.05)' : '#faf6f1'}; color:${t.text}; min-height:80px; resize:vertical; outline:none; margin-bottom:0.8rem;"></textarea>
        <button onclick="sendWish()" style="width:100%; padding:0.7rem; background:${t.accent}; color:white; border:none; border-radius:4px; cursor:pointer; font-family:'Jost',sans-serif; font-size:0.82rem; letter-spacing:0.08em; text-transform:uppercase">Kirim Ucapan üíå</button>
      </div>
      <div id="wishesList" style="max-width:480px; margin:1.5rem auto 0;"></div>
    </section>` : '';

  const mapsHTML = d.features.maps && (d.mapsAkad || d.mapsResepsi) ? `
    <section style="padding:2rem 1.5rem; text-align:center; background:${isDark ? '#100e0a' : 'white'};">
      <h2 style="font-family:'Cormorant Garamond',serif; font-size:1.8rem; color:${t.text}; margin-bottom:1.5rem">üìç Lokasi Acara</h2>
      <div style="display:flex; gap:1rem; justify-content:center; flex-wrap:wrap;">
        ${d.mapsAkad ? `<a href="${d.mapsAkad}" target="_blank" style="padding:0.8rem 1.5rem; border:1px solid ${t.accent}; color:${t.accent}; text-decoration:none; border-radius:4px; font-size:0.82rem">üó∫ Peta Lokasi Akad</a>` : ''}
        ${d.mapsResepsi ? `<a href="${d.mapsResepsi}" target="_blank" style="padding:0.8rem 1.5rem; background:${t.accent}; color:white; text-decoration:none; border-radius:4px; font-size:0.82rem">üó∫ Peta Lokasi Resepsi</a>` : ''}
      </div>
    </section>` : '';

  const countdownHTML = d.features.countdown && (d.akad.date || d.resepsi.date) ? `
    <section style="padding:2rem 1.5rem; text-align:center; background:${t.cover};">
      <p style="font-size:0.75rem; color:${t.text}; letter-spacing:0.2em; text-transform:uppercase; margin-bottom:1rem; opacity:0.8">Menuju Hari Bahagia</p>
      <div id="countdown" style="display:flex; gap:1rem; justify-content:center; flex-wrap:wrap;">
        <div style="min-width:70px; padding:1rem; background:rgba(255,255,255,0.2); border-radius:8px; backdrop-filter:blur(4px)">
          <div style="font-family:'Cormorant Garamond',serif; font-size:2.5rem; color:${t.text}" id="cd-days">00</div>
          <div style="font-size:0.7rem; color:${t.text}; opacity:0.7">HARI</div>
        </div>
        <div style="min-width:70px; padding:1rem; background:rgba(255,255,255,0.2); border-radius:8px; backdrop-filter:blur(4px)">
          <div style="font-family:'Cormorant Garamond',serif; font-size:2.5rem; color:${t.text}" id="cd-hours">00</div>
          <div style="font-size:0.7rem; color:${t.text}; opacity:0.7">JAM</div>
        </div>
        <div style="min-width:70px; padding:1rem; background:rgba(255,255,255,0.2); border-radius:8px; backdrop-filter:blur(4px)">
          <div style="font-family:'Cormorant Garamond',serif; font-size:2.5rem; color:${t.text}" id="cd-mins">00</div>
          <div style="font-size:0.7rem; color:${t.text}; opacity:0.7">MENIT</div>
        </div>
        <div style="min-width:70px; padding:1rem; background:rgba(255,255,255,0.2); border-radius:8px; backdrop-filter:blur(4px)">
          <div style="font-family:'Cormorant Garamond',serif; font-size:2.5rem; color:${t.text}" id="cd-secs">00</div>
          <div style="font-size:0.7rem; color:${t.text}; opacity:0.7">DETIK</div>
        </div>
      </div>
    </section>
    <script>
      const targetDate = new Date('${d.akad.date || d.resepsi.date}');
      function updateCountdown() {
        const now = new Date();
        const diff = targetDate - now;
        if (diff <= 0) { document.getElementById('countdown').innerHTML = '<p style="color:inherit">Hari Bahagia Telah Tiba! üéâ</p>'; return; }
        const days = Math.floor(diff / 86400000);
        const hours = Math.floor((diff % 86400000) / 3600000);
        const mins = Math.floor((diff % 3600000) / 60000);
        const secs = Math.floor((diff % 60000) / 1000);
        document.getElementById('cd-days').textContent = String(days).padStart(2,'0');
        document.getElementById('cd-hours').textContent = String(hours).padStart(2,'0');
        document.getElementById('cd-mins').textContent = String(mins).padStart(2,'0');
        document.getElementById('cd-secs').textContent = String(secs).padStart(2,'0');
      }
      updateCountdown(); setInterval(updateCountdown, 1000);
    <\/script>` : '';

  const verseHTML = d.features.verse && d.verseText ? `
    <section style="padding:2.5rem 1.5rem; text-align:center; background:${isDark ? 'rgba(255,255,255,0.03)' : '#faf6f1'};">
      <p style="font-family:'Cormorant Garamond',serif; font-size:1.2rem; font-style:italic; color:${t.text}; max-width:500px; margin:0 auto; line-height:1.8">"${d.verseText}"</p>
      ${d.verseSource ? `<p style="font-size:0.78rem; color:${t.accent}; margin-top:0.8rem; letter-spacing:0.1em">‚Äî ${d.verseSource}</p>` : ''}
    </section>` : '';

  return `<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Undangan Pernikahan ${d.groom.nick || d.groom.full} & ${d.bride.nick || d.bride.full}</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Jost',sans-serif; background:${t.bg}; color:${t.text}; overflow-x:hidden; }
  @keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
  .fade { animation: fadeIn 1s ease forwards; }
  section { position:relative; }
</style>
</head>
<body>

<!-- COVER -->
<section style="min-height:100vh; background:${t.cover}; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:2rem; position:relative; overflow:hidden;">
  ${d.photos.cover ? `<div style="position:absolute;inset:0;overflow:hidden;"><img src="${d.photos.cover}" style="width:100%;height:100%;object-fit:cover;opacity:0.3" alt="Foto Sampul"></div>` : ''}
  <div style="position:relative; z-index:2;" class="fade">
    <p style="font-size:0.72rem; letter-spacing:0.3em; text-transform:uppercase; color:${t.text}; opacity:0.7; margin-bottom:1.5rem">Undangan Pernikahan</p>
    <h1 style="font-family:'Cormorant Garamond',serif; font-size:clamp(2.5rem,8vw,5rem); font-weight:300; color:${t.text}; line-height:1.2; margin-bottom:0.5rem">${d.groom.nick || d.groom.full}</h1>
    <p style="font-size:1.2rem; color:${t.accent}; margin-bottom:0.5rem">&</p>
    <h1 style="font-family:'Cormorant Garamond',serif; font-size:clamp(2.5rem,8vw,5rem); font-weight:300; font-style:italic; color:${t.text}; line-height:1.2">${d.bride.nick || d.bride.full}</h1>
    ${d.akad.date ? `<p style="font-size:0.75rem; letter-spacing:0.2em; color:${t.text}; opacity:0.7; margin-top:1.5rem; text-transform:uppercase">${akadFormatted}</p>` : ''}
  </div>
  <div style="position:absolute;bottom:2rem;left:50%;transform:translateX(-50%);animation:bounce 2s infinite">
    <p style="font-size:0.7rem; color:${t.text}; opacity:0.5; letter-spacing:0.15em">GULIR KE BAWAH</p>
    <p style="text-align:center; color:${t.text}; opacity:0.5">‚Üì</p>
  </div>
</section>

<!-- BISMILLAH / PEMBUKA -->
${verseHTML}

<!-- MEMPELAI -->
<section style="padding:4rem 1.5rem; text-align:center; background:${isDark ? t.light : 'white'};">
  <p style="font-size:0.72rem; letter-spacing:0.25em; text-transform:uppercase; color:${t.accent}; margin-bottom:2rem">Bismillah, dengan memohon ridho Allah SWT</p>
  <p style="color:${isDark ? 'rgba(255,255,255,0.6)' : '#8a7a72'}; font-size:0.9rem; margin-bottom:3rem; max-width:400px; margin-left:auto; margin-right:auto; line-height:1.7">Dengan penuh kebahagiaan, kami mengundang Bapak/Ibu/Saudara/i untuk hadir di pernikahan kami</p>
  <div style="display:flex; gap:2rem; justify-content:center; align-items:center; flex-wrap:wrap;">
    <div style="flex:1; min-width:200px;">
      ${d.photos.cover ? '' : '<div style="width:120px;height:120px;border-radius:50%;background:'+t.accent+';opacity:0.2;margin:0 auto 1rem;display:flex;align-items:center;justify-content:center;font-size:2.5rem">ü§µ</div>'}
      <h2 style="font-family:'Cormorant Garamond',serif; font-size:1.8rem; color:${t.text}">${d.groom.full}</h2>
      ${d.groom.order ? `<p style="font-size:0.78rem; color:${t.accent}; margin:0.3rem 0">Putra ${d.groom.order}</p>` : ''}
      ${d.groom.parents ? `<p style="font-size:0.82rem; color:${isDark ? 'rgba(255,255,255,0.6)' : '#8a7a72'}">dari ${d.groom.parents}</p>` : ''}
    </div>
    <div style="font-family:'Cormorant Garamond',serif; font-size:3rem; color:${t.accent}; font-style:italic">&</div>
    <div style="flex:1; min-width:200px;">
      <h2 style="font-family:'Cormorant Garamond',serif; font-size:1.8rem; font-style:italic; color:${t.text}">${d.bride.full}</h2>
      ${d.bride.order ? `<p style="font-size:0.78rem; color:${t.accent}; margin:0.3rem 0">Putri ${d.bride.order}</p>` : ''}
      ${d.bride.parents ? `<p style="font-size:0.82rem; color:${isDark ? 'rgba(255,255,255,0.6)' : '#8a7a72'}">dari ${d.bride.parents}</p>` : ''}
    </div>
  </div>
</section>

<!-- FOTO TENGAH -->
${d.photos.middle ? `<section style="padding:0; background:${isDark ? t.bg : '#faf6f1'};"><img src="${d.photos.middle}" style="width:100%;max-height:60vh;object-fit:cover;display:block" alt="Foto Mempelai"></section>` : ''}

<!-- COUNTDOWN -->
${countdownHTML}

<!-- DETAIL ACARA -->
<section style="padding:4rem 1.5rem; background:${isDark ? t.bg : 'white'};">
  <h2 style="font-family:'Cormorant Garamond',serif; font-size:2rem; text-align:center; color:${t.text}; margin-bottom:3rem">Waktu & Tempat</h2>
  <div style="display:flex; gap:1.5rem; justify-content:center; flex-wrap:wrap; max-width:800px; margin:0 auto;">
    ${d.akad.date ? `
    <div style="flex:1; min-width:280px; border:1px solid ${isDark ? 'rgba(201,169,110,0.2)' : '#f0e8dc'}; border-radius:8px; padding:2rem; text-align:center; background:${isDark ? 'rgba(255,255,255,0.03)' : '#faf6f1'};">
      <p style="font-size:0.72rem; text-transform:uppercase; letter-spacing:0.2em; color:${t.accent}; margin-bottom:1rem">Akad Nikah</p>
      <p style="font-family:'Cormorant Garamond',serif; font-size:1.5rem; color:${t.text}">${akadFormatted}</p>
      ${d.akad.start ? `<p style="font-size:0.85rem; color:${isDark ? 'rgba(255,255,255,0.6)' : '#8a7a72'}; margin-top:0.5rem">${fmt(d.akad.start)} ${d.akad.end ? '‚Äì '+fmt(d.akad.end) : ''}</p>` : ''}
      ${d.akad.venue ? `<p style="font-size:0.82rem; color:${isDark ? 'rgba(255,255,255,0.5)' : '#8a7a72'}; margin-top:0.7rem">${d.akad.venue}</p>` : ''}
    </div>` : ''}
    ${d.resepsi.date ? `
    <div style="flex:1; min-width:280px; border:1px solid ${isDark ? 'rgba(201,169,110,0.3)' : '#c9a96e'}; border-radius:8px; padding:2rem; text-align:center; background:${isDark ? 'rgba(201,169,110,0.05)' : 'rgba(201,169,110,0.05)'};">
      <p style="font-size:0.72rem; text-transform:uppercase; letter-spacing:0.2em; color:${t.accent}; margin-bottom:1rem">Resepsi</p>
      <p style="font-family:'Cormorant Garamond',serif; font-size:1.5rem; color:${t.text}">${resepsiFormatted}</p>
      ${d.resepsi.start ? `<p style="font-size:0.85rem; color:${isDark ? 'rgba(255,255,255,0.6)' : '#8a7a72'}; margin-top:0.5rem">${fmt(d.resepsi.start)} ${d.resepsi.end ? '‚Äì '+fmt(d.resepsi.end) : ''}</p>` : ''}
      ${d.resepsi.venue ? `<p style="font-size:0.82rem; color:${isDark ? 'rgba(255,255,255,0.5)' : '#8a7a72'}; margin-top:0.7rem">${d.resepsi.venue}</p>` : ''}
      ${d.resepsi.address ? `<p style="font-size:0.78rem; color:${isDark ? 'rgba(255,255,255,0.4)' : '#aaa'}; margin-top:0.4rem">${d.resepsi.address}</p>` : ''}
    </div>` : ''}
  </div>
</section>

<!-- MAPS -->
${mapsHTML}

<!-- GALERI -->
${galleryImgs ? `
<section style="padding:4rem 1.5rem; background:${isDark ? t.light : '#faf6f1'};">
  <h2 style="font-family:'Cormorant Garamond',serif; font-size:2rem; text-align:center; color:${t.text}; margin-bottom:2rem">Galeri Foto</h2>
  <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:0.8rem; max-width:700px; margin:0 auto;">${galleryImgs}</div>
</section>` : ''}

<!-- REKENING -->
${banksHTML ? `
<section style="padding:4rem 1.5rem; background:${isDark ? t.bg : 'white'};">
  <h2 style="font-family:'Cormorant Garamond',serif; font-size:2rem; text-align:center; color:${t.text}; margin-bottom:0.5rem">Amplop Digital</h2>
  <p style="text-align:center; color:${isDark ? 'rgba(255,255,255,0.5)' : '#8a7a72'}; font-size:0.82rem; margin-bottom:2rem">Bagi yang ingin memberikan hadiah, bisa transfer ke rekening berikut</p>
  <div style="max-width:500px; margin:0 auto;">${banksHTML}</div>
</section>` : ''}

<!-- UCAPAN -->
${wishFormHTML}

<!-- CLOSING -->
<section style="padding:4rem 1.5rem; text-align:center; background:${t.cover}; position:relative; overflow:hidden;">
  <p style="font-family:'Cormorant Garamond',serif; font-size:2.5rem; color:${t.text}; margin-bottom:0.5rem">Terima Kasih</p>
  <p style="font-size:0.85rem; color:${t.text}; opacity:0.7; margin-bottom:2rem; max-width:400px; margin-left:auto; margin-right:auto; line-height:1.7">Merupakan kehormatan dan kebahagiaan bagi kami apabila Bapak/Ibu/Saudara/i berkenan hadir memberikan doa restu</p>
  <p style="font-family:'Cormorant Garamond',serif; font-size:1.5rem; font-style:italic; color:${t.text}">${d.groom.nick || d.groom.full} & ${d.bride.nick || d.bride.full}</p>
  <p style="font-size:0.6rem; color:${t.text}; opacity:0.3; margin-top:3rem">Dibuat dengan ‚ù§Ô∏è oleh Invitify</p>
</section>

<script>
function sendWish() {
  const name = document.getElementById('wishName')?.value.trim();
  const msg = document.getElementById('wishMsg')?.value.trim();
  if (!name || !msg) { alert('Mohon isi nama dan pesan Anda.'); return; }
  const wishes = JSON.parse(localStorage.getItem('wishes_${passkey}') || '[]');
  wishes.unshift({ name, msg, time: new Date().toLocaleString('id-ID') });
  localStorage.setItem('wishes_${passkey}', JSON.stringify(wishes));
  document.getElementById('wishName').value = '';
  document.getElementById('wishMsg').value = '';
  renderWishes();
}
function renderWishes() {
  const list = document.getElementById('wishesList');
  if (!list) return;
  const wishes = JSON.parse(localStorage.getItem('wishes_${passkey}') || '[]');
  list.innerHTML = wishes.map(w => \`
    <div style="background:rgba(255,255,255,0.1);border:1px solid rgba(201,169,110,0.2);border-radius:6px;padding:0.8rem 1rem;text-align:left;margin-bottom:0.5rem;">
      <div style="font-size:0.82rem;font-weight:500;color:${t.accent}">\${w.name}</div>
      <div style="font-size:0.82rem;color:${t.text};opacity:0.8;margin-top:0.2rem">\${w.msg}</div>
      <div style="font-size:0.68rem;color:${t.text};opacity:0.4;margin-top:0.3rem">\${w.time}</div>
    </div>\`).join('');
}
renderWishes();
<\/script>

</body>
</html>`;
}
</script>
</body>
</html>
